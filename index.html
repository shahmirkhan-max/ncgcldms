<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NCGCL – Board Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI"; margin: 0; background: #f5f7fb; }
    header { background: #035076; color: white; padding: 20px 40px; }
    .container { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    .card { background: white; padding: 20px; margin-bottom: 16px; border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04); }
    .card h2 { margin-top: 0; color: #035076; }
    .muted { color: #666; font-size: 0.9rem; }

    .button-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 12px;
    }

    .link-button {
      display: inline-block;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid #035076;
      text-decoration: none;
      font-size: 0.9rem;
      color: #035076;
      background: #f5f7fb;
      white-space: nowrap;
    }

    .link-button:hover {
      background: #035076;
      color: #fff;
    }

    @media (max-width: 600px) {
      .link-button {
        width: 100%;
        text-align: center;
        white-space: normal;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>NCGCL – Board Dashboard</h1>
    <p>Guarantee, investment, and risk overview</p>
  </header>

  <main class="container">
    <!-- Intro / current description (static text, you can tweak as needed) -->
    <section class="card">
      <h2>Board Portal Home</h2>
      <p>
        This page serves as the entry point for all NCGCL board dashboards and
        related HTML packs hosted in this repository.
      </p>
      <p class="muted">
        The buttons below are automatically generated by reading all <code>.html</code> files
        in this GitHub repository (excluding this home page).
      </p>
    </section>

    <!-- Auto-generated list of all other HTML files -->
    <section class="card">
      <h2>All Board Packs & HTML Pages</h2>
      <p class="muted">
        Click any button to open the corresponding HTML dashboard or board pack in a new tab.
      </p>

      <div id="html-buttons" class="button-grid">
        <!-- JS will populate this -->
      </div>

      <p id="all-error" class="muted" style="color:#c00; margin-top:12px; display:none;">
        Unable to load the list of HTML pages at the moment.
      </p>
    </section>
  </main>

  <script>
    // Small helper to convert "2025-Q1-board-pack.html" → "2025 Q1 board pack"
    function niceLabelFromPath(path) {
      const parts = path.split('/');
      const file = parts[parts.length - 1];
      const name = file.replace(/\.html$/i, '');
      return name.replace(/[-_]/g, ' ');
    }

    (async function () {
      try {
        // Derive owner + repo from the current GitHub Pages URL
        // e.g. https://username.github.io/repo-name/
        const hostParts = window.location.hostname.split('.');
        const owner = hostParts[0];  // "username" in username.github.io

        const pathParts = window.location.pathname.split('/').filter(Boolean);
        const repo = pathParts[0];   // "repo-name" in /repo-name/

        if (!owner || !repo) {
          throw new Error('Unable to infer owner/repo from URL.');
        }

        const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents`;

        // Recursively fetch all .html files in the repo
        async function fetchHtmlFiles(subPath = '') {
          const url = subPath ? `${apiBase}/${subPath}` : apiBase;
          const res = await fetch(url);
          if (!res.ok) {
            throw new Error(`GitHub API HTTP ${res.status} for ${url}`);
          }
          const items = await res.json();
          let results = [];

          for (const item of items) {
            if (item.type === 'file' && item.name.toLowerCase().endsWith('.html')) {
              const relPath = subPath ? `${subPath}/${item.name}` : item.name;
              // Exclude index.html (home page)
              if (relPath.toLowerCase() !== 'index.html') {
                results.push(relPath);
              }
            } else if (item.type === 'dir') {
              const nested = await fetchHtmlFiles(item.path);
              results = results.concat(nested);
            }
          }
          return results;
        }

        const htmlFiles = await fetchHtmlFiles('');

        const container = document.getElementById('html-buttons');
        if (!htmlFiles.length) {
          container.innerHTML = '<p class="muted">No additional HTML pages found in this repository.</p>';
          return;
        }

        // Base URL for GitHub Pages (ensure trailing slash)
        let basePath = window.location.pathname;
        // If we're on /repo or /repo/index.html, normalize to /repo/
        if (!basePath.endsWith('/')) {
          basePath = basePath.replace(/index\.html$/i, '');
          if (!basePath.endsWith('/')) basePath += '/';
        }
        const baseUrl = window.location.origin + basePath;

        htmlFiles.forEach(relPath => {
          const btn = document.createElement('a');
          btn.className = 'link-button';
          btn.href = baseUrl + relPath;
          btn.target = '_blank';
          btn.textContent = niceLabelFromPath(relPath);
          container.appendChild(btn);
        });

      } catch (err) {
        console.error('Error listing HTML files:', err);
        document.getElementById('all-error').style.display = 'block';
      }
    })();
  </script>
</body>
</html>
